<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>How we roll - rapport</title>
    <style>
        body {
            background-color: #222;
            color: #ededed;
        }
    </style>
    <!--

       [[[[[[[[     [[[[[[[[        [[[[   [[[[   [[[[  [[[[
       [::::::[    [::[             [::[   [::[   [::[  [::[
         [::[      [::[             [::[   [::[   [::[  [::[
         [::[       [::::[   [[[[   [::[   [::[   [[[[[[[[[[
         [::[          [::[         [::[   [::[         [::[
       [::::::[        [::[         [::[   [::[         [::[
       [[[[[[[[   [[[[[[[[          [[[[   [[[[         [[[[

    -->
</head>
<body>
<!-- Her skrives alt innhold, som man ønsker å "tegne" på skjermen. -->

<table>
    <thead>
        <tr>
            <th colspan="3"><h3>How we roll</h3></th>

        </tr>
    </thead>
    <tbody id="howWeRollTableBody">


    </tbody>
    <tfoot>
        <tr>
            <td style="text-align: right; vertical-align: top">Personer:</td>
            <td colspan="2" >
                <canvas id="personer" width="240" height="200"></canvas>
            </td>
        </tr>
    </tfoot>
</table>

<canvas id="report"></canvas>

<script>
    // Denne variabelen inneholder alle spørsmålene i formen, eksisterer i både formen og rapporten
    let spm = [
        ["morgenEllerNatt", "Morgenfugl", "Nattugle"],
        ["lagarbeid", "Fortrekker å jobbe selvstendig", "Foretrekker å jobbe i gruppe"],
        ["improvisere", "Planlegge nøye først", "Improvisere"],
        ["perfeksjonist", "Tidsorientert", "Perfeksjonist"],
        ["Åpen for nye ideer", "Konservativ", "Åpen"],
        ["Fort irritert", "Konfliktsy", "Fort irritert"],
        ["Besluttsom", "Ubesluttsom", "Besluttsom"],
        ["Jobbe i korte eller lange perioder", "Korte", "Lange"],
        ["Få ting gjort eller ta seg god tid", "Få ting gjort", "Ta seg god tid"],
        ["Liker å lede?", "Følge", "Lede"]

    ];

    // Liste over alle svarene/personene som skal hentes fra server
    const jsons = ["20211007143134-55072c51403363773e83858da2112548.json",
        "20211007143217-9c6ee71285f8565508a3fd869e716ab6.json",
        "20211007143236-51c9a7392dc942da26cbc954d081ab28.json"];

    //Denne delen brukes til å holde telling over hvor mange ganger et spørsmål har hatt en verdi.
    let emptyArray = new Array(11);
    for (let i = 0; i < 11; i++) {
        emptyArray[i] = 0;
    }
    console.log(emptyArray);
    for (let i = 0; i < spm.length; i++) {
        spm[i].push([...emptyArray]);
    }

    let howWeRollTableBody = document.getElementById('howWeRollTableBody');
    spm.forEach(skrivSpørsmål);

    //Bygger opp tabellen med rader for hvert spørsmål
    function skrivSpørsmål(item) {
        let tr = document.createElement('tr');
        let inner = '<td style="text-align:right;"><label for="' + item[0] + '">' + item[1] + '</label></td>' +
            '<td><canvas id="canvas-' + item[0] + '" width="240" height="40"></canvas></td>' +
            '<td><label for="' + item[0] + '">' + item[2] + '</label></td>';
        tr.innerHTML = inner;
        howWeRollTableBody.appendChild(tr);
    }

    //Tegn linjene for hver canvas/spørsmål:
    spm.forEach(function(s) {
        let canvas = document.getElementById('canvas-' + s[0]);
        let context = canvas.getContext('2d');

        context.beginPath();
        context.moveTo(20,20);
        context.lineTo(220,20);
        context.strokeStyle = "#aaa";
        context.stroke();
    })

    let personI = 0;
    jsons.forEach(renderJSON);
    //Skriver ut data på canvaser for en JSON fil.
    async function renderJSON(item) {
        //hente json fra serveren
        await fetch('https://bacit.info/hwr/' + item, {cache: 'no-cache'})
            .then(response => response.json())
            .then(data => {
                //data inneholder modellen
                //farge for personen
                let color = 'hsl('+ personI/jsons.length * 360 +', 100%, 70%)';

                //loop igjennom alle spørsmålene og fyll inn "dottene":
                let i = 0;
                spm.forEach(function(s){
                    let intVal = parseInt(data[s[0]]); //int verdien for spørsmålet
                    let canvas = document.getElementById('canvas-' + s[0]);
                    let context = canvas.getContext('2d');

                    let X = 20 + intVal * 20;
                    let Y = 20 + spm[i][3][intVal] * 5; //spm[i][3][intVal] = antall ganger dette spørmålet har blitt besvart med samme verdi tidligere, forskyv dotten ned litt
                    let R = 6;
                    context.beginPath();
                    context.arc(X, Y, R, 0, 2*Math.PI, false);
                    context.fillStyle = color;
                    context.fill();
                    context.lineWidth = 1;
                    context.strokeStyle = "#111";
                    context.stroke();

                    spm[i][3][intVal]++;
                    i++;
                });

                //legg til person navn og farge i listen over personer, brukes til å skrive ut listen over personer senere
                skrivNavn([data.navn, color]);
                personI++;

            });
    }

    //Funksjon som skriver personen til listen over personer, med gitt farget.
    function skrivNavn(person) {
        let personerCanvas = document.getElementById('personer');
        let personercontext = personerCanvas.getContext('2d');
        console.log(person);
        let X = 20;
        let Y = 10 + personI * 20;
        let R = 6;
        personercontext.beginPath();
        personercontext.arc(X, Y, R, 0, 2*Math.PI, false);
        personercontext.fillStyle = person[1];
        personercontext.fill();
        personercontext.lineWidth = 1;
        personercontext.strokeStyle = "#ccc";
        personercontext.stroke();

        personercontext.font = '14px serif';
        personercontext.fillText(person[0], X + 20, Y + 5);

    }


</script>
</body>
</html>