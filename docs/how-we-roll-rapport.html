<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>How we roll - rapport</title>
    <style>
        body {
            background-color: #222;
            color: #ededed;
        }
    </style>
    <!--

       [[[[[[[[     [[[[[[[[        [[[[   [[[[   [[[[  [[[[
       [::::::[    [::[             [::[   [::[   [::[  [::[
         [::[      [::[             [::[   [::[   [::[  [::[
         [::[       [::::[   [[[[   [::[   [::[   [[[[[[[[[[
         [::[          [::[         [::[   [::[         [::[
       [::::::[        [::[         [::[   [::[         [::[
       [[[[[[[[   [[[[[[[[          [[[[   [[[[         [[[[

    -->
</head>
<body>
<!-- Her skrives alt innhold, som man ønsker å "tegne" på skjermen. -->

<table>
    <thead>
        <tr>
            <th colspan="3"><h3>How we roll</h3></th>

        </tr>
    </thead>
    <tbody id="howWeRollTableBody">


    </tbody>
    <tfoot>
        <tr>
            <td colspan="3">
                <canvas id="personer" width="300" height="400"></canvas>
            </td>
        </tr>
    </tfoot>
</table>

<canvas id="report"></canvas>

<script>
    // Dette er en kommentar
    var spm = [
        ["morgenEllerNatt", "Morgenfugl", "Nattugle"],
        ["lagarbeid", "Fortrekker å jobbe selvstendig", "Foretrekker å jobbe i gruppe"],
        ["improvisere", "Planlegge nøye først", "Improvisere"],
       ];


    const jsons = ["20211007100530-7d170895649d242b823fad8757145257.json",
        "20211007100610-a99f9a2a596db0f8e41de8ff268689eb.json",
        "20211007100632-2220794f961a680a55789a4e6a189001.json"];

    let emptyArray = new Array(11);
    for (let i = 0; i < 11; i++) {
        emptyArray[i] = 0;
    }
    console.log(emptyArray);
    for (let i = 0; i < spm.length; i++) {
        spm[i].push([...emptyArray]);
    }
    console.log(spm);

    let howWeRollTableBody = document.getElementById('howWeRollTableBody');
    spm.forEach(skrivSpørsmål);

    //Bygger opp tabellen med rader for hvert spørsmål
    function skrivSpørsmål(item) {

        let tr = document.createElement('tr');
        let inner = '<td style="text-align:right;"><label for="' + item[0] + '">' + item[1] + '</label></td>' +
            '<td><canvas id="canvas-' + item[0] + '" width="240" height="40"></canvas></td>' +
            '<td><label for="' + item[0] + '">' + item[2] + '</label></td>';
        tr.innerHTML = inner;

        howWeRollTableBody.appendChild(tr);
    }

    /*
    fetch('https://bacit.info/hwr/20210926134925-47352fbdecddd9a754001f4e4abbf40f.json')
    .then(response => response.json())
    .then(data => console.log(data));

    fetch('https://bacit.info/hwr/20210926162029-a89356bb617d3bbf870649c08570427e.json')
    .then(response => response.json())
    .then(data => console.log(data));

    fetch('https://bacit.info/hwr/20210927113650-03cb3bd829e6445c77d338b671670a58.json')
    .then(response => response.json())
    .then(data => console.log(data));

    var canvas = document.getElementById('report');
    var context = canvas.getContext('2d');
    */




    spm.forEach(function(s) {
        var canvas = document.getElementById('canvas-' + s[0]);
        var context = canvas.getContext('2d');

        context.beginPath();
        context.moveTo(20,20);
        context.lineTo(220,20);
        context.strokeStyle = "#aaa";
        context.stroke();
    })

    var personer = new Array();
    jsons.forEach(renderJSON);
    //Skriver ut data på canvaser for en JSON fil.
    async function renderJSON(item) {
        //hente json fra serveren
        await fetch('https://bacit.info/hwr/' + item, {cache: 'no-cache'})
            .then(response => response.json())
            .then(data => {
                //data inneholder modellen
                let color = 'hsl('+Math.random() * 360 +', 100%, 40%)';

                let i = 0;
                spm.forEach(function(s){
                    let intVal = parseInt(data[s[0]]);
                    let canvas = document.getElementById('canvas-' + s[0]);
                    let context = canvas.getContext('2d');

                    let X = 20 + intVal * 20;
                    let Y = 20 + spm[i][3][intVal] * 5;
                    let R = 6;
                    context.beginPath();
                    context.arc(X, Y, R, 0, 2*Math.PI, false);
                    context.fillStyle = color;
                    context.fill();
                    context.lineWidth = 1;
                    context.strokeStyle = "#111";
                    context.stroke();

                    spm[i][3][intVal]++;
                    i++;
                });

                personer.push([data.navn, color]);


            });
    }

    let personerCanvas = document.getElementById('personer');
    let personercontext = personerCanvas.getContext('2d');
    let i = 0;
    skrivNavn();
    function skrivNavn() {


        personer.forEach(function(item){
            console.log(item);
            let X = 20;
            let Y = 20 + i * 20;
            let R = 6;
            personercontext.beginPath();
            personercontext.arc(X, Y, R, 0, 2*Math.PI, false);
            personercontext.fillStyle = item[1];
            personercontext.fill();
            personercontext.lineWidth = 1;
            personercontext.strokeStyle = "#ccc";
            personercontext.stroke();

            personercontext.font = '14px serif';
            personercontext.fillText(item[0], X + 20, Y);
            i++;
            console.log(item);
        });
    }


</script>
</body>
</html>